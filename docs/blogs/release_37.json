{
  "Title": "Create Mind-Blowing Visuals Using Flutter Shaders",
  "Slug": "create-mind-blowing-visuals-using-shaders-in-flutter",
  "Collection ID": "642da2c43fe34c364a69857f",
  "Item ID": "642da2c43fe34c0cd3698a89",
  "Created On": "Tue Jun 28 2022 18:45:32 GMT+0000 (Coordinated Universal Time)",
  "Updated On": "Tue Feb 14 2023 19:17:35 GMT+0000 (Coordinated Universal Time)",
  "PublishedOn": "Wed Apr 05 2023 16:53:15 GMT+0000 (Coordinated Universal Time)",
  "MainImage": "https://uploads-ssl.webflow.com/6143afec68f555387049efb3/63e6890db33763465e8f0fca_shaders.jpg",
  "Post summary": "Learn how to add fragment Flutter shaders to your applications to really make your visuals pop.",
  "FullPost": "<p id=\"\">Have you ever played a video game or watched a movie and been so blown away that you heard yourself saying, “WOW! I wonder how they did this?”</p><p id=\"\">Most of the time, these rich visuals are created using a combination of Flutter shaders. Take a look at the visuals in this article, where shaders play a critical role. Today, you’ll learn about a specific type of shader called a Fragment Shader and how to use it in your Flutter application. Outside of specifically discussing Flutter Fragment Shaders, I’ll touch on many other things including giving you some basic background on shaders for those who may not be as familiar.</p><p id=\"\">With that, let’s get started!</p><h2 id=\"\">What are Shaders?</h2><p id=\"\">Shaders are a set of instructions that a system executes for every single pixel on the screen. They are responsible for manipulating the color value including light and darkness for that pixel during rendering. Instead of painting layer by layer, you paint every single pixel on the screen, giving you more control over your painting.</p><p id=\"\">These instructions run for every pixel in parallel; thus, shaders in Flutter require quite a lot of computational resources to run smoothly. It is also important to note that shaders run on your GPU (Graphical Processing Unit), which is specially made for handling tasks like manipulating pixels and images. Because of this, shaders are extremely fast.</p><h2 id=\"\">How to Write a GLSL Shader</h2><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-center\" data-rt-type=\"image\" data-rt-align=\"center\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4895417bcd8181f6d39b_1*4I9rHY7WTzjlhommUPaqEg.png\" alt=\"A blue-purple color gradient.\" width=\"auto\" height=\"auto\" loading=\"auto\" id=\"\"></div></figure><p id=\"\">There are multiple languages you can use to write shaders, including GLSL (OpenGL Shading Language), SKSL (Skia’s Shading Language) and MetalSL (used by Apple devices), among others. If you’re familiar with languages like Dart or C, you should be able to pick up these languages fairly quickly. For the sake of this tutorial, I’ll stick to one language, GLSL.</p><p id=\"\">For a gentle introduction to writing a GLSL shader, we will be coding a simple example of a shader that outputs the beautiful gradient displayed above.</p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" data-rt-type=\"image\" data-rt-align=\"fullwidth\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb49667351cdb271e1c19a_GLSL%20Shader.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet to create a GLSL Shader.\"></div></figure><p id=\"\">‍</p><p id=\"\">Let’s go over the code step-by-step :</p><ul id=\"\"><li id=\"\">Like Dart, GLSL defines a single entry point through the <em id=\"\">main()</em> function. At the end of this function, you set the color for the pixel.</li><li id=\"\">GLSL has built-in variables like <em id=\"\">gl_FragCoord</em> and <em id=\"\">gl_FragColor</em>. <em id=\"\">gl_FragCoord</em> gives you the pixel vector position, and you set the pixel color through the <em id=\"\">gl_FragColor</em>. When you specify a vec4, you’re actually setting the rgba values of the color for that pixel.</li><li id=\"\">GLSL allows us to create conditional compilation blocks and defining values in the pre-compilation stage. These blocks or values start with <em id=\"\">#</em>. <em id=\"\">#ifdef(if defined)#endif</em> is a conditional operation block that is checked before compilation. The 2nd line executes if the GL_ES is defined, which is a version of GLSL for embedded systems like mobile devices and video game consoles.</li><li id=\"\">Level of precision is everything when you’re dealing with colors. The more precise you are, the better quality you get. The 2nd line sets the float precision to <em id=\"\">mediump</em>. You can also change it to <em id=\"\">lowp</em> or <em id=\"\">highp</em> if you want.</li><li id=\"\">Inputs for GLSL shaders are defined by adding a <em id=\"\">uniform</em> in front of them at the top of your code. One of the most important inputs is the <em id=\"\">u_resolution</em> (also called the <em id=\"\">iResolution</em>) of <em id=\"\">type vec2</em> which gives you the resolution of the screen.</li></ul><blockquote id=\"\">If you want to learn more about Flutter shaders and how to write them in detail, check out <a href=\"https://thebookofshaders.com/\" target=\"_blank\" id=\"\">The Book of Shaders</a>.</blockquote><p id=\"\">‍</p><h2 id=\"\">Implementing Shaders in Flutter</h2><p id=\"\">With the release of Flutter 3.0, initial support for creating custom shaders was moved to stable. Therefore, it’s important to make sure you’re running the latest version.</p><p id=\"\">You can upgrade to the latest version by running the following:</p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb49fdefe82f640ec909ab_Flutter%20Upgrade.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with Flutter. \"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=c7c447a1b7\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">‍</p><p id=\"\">If you’ve been around Flutter for a while, you may already know that Skia is the Flutter rendering engine that is used for rendering UI and SKSL is its shading language.</p><p id=\"\">Support for Flutter custom shaders is through the SPIR-V Dart API, which was moved to stable in the release of Flutter 3.0. SPIR-V is an intermediary language designed to act as a bridge between different shading languages in order to make it easier to port shaders from one language to another.</p><p id=\"\">To use custom shaders in Flutter, you convert your GLSL code to SPIR-V binaries. (<a href=\"https://github.com/flutter/flutter/issues/93498\" target=\"_blank\" id=\"\">Learn more about this.</a>) Once you have the binaries, you need to use the FragmentProgram from the SPIR-V library, which helps to compile the SPIR-V binary to SKSL and to create a shader from it. However, this manual process is quite time-consuming and not that intuitive if you’d like to get started quickly with Flutter shaders.</p><p id=\"\">To make things easier, we’ll be taking a look at a tool that will automate this process and generate the SPIR-V binaries from our GLSL code, as well as provide an intuitive API to learn GLSL shaders in Flutter.</p><blockquote id=\"\">Support for writing custom Flutter shaders is a work in progress and not yet marked for production.</blockquote><p id=\"\">‍</p><h2 id=\"\">Compiling Shaders Using Umbra</h2><p id=\"\">To make your life a little easier, there’s an amazing tool from the community called Umbra that handles shader compilation and creation for Flutter.</p><blockquote id=\"\">Umbra is a CLI and visual editor for writing Flutter shaders. It comes with an abstraction on top of the Flutter API to make the lives of developers that want to write shaders easier. The main goal, therefore, is to make writing shaders in Flutter easier, faster, and overall more enjoyable. — Umbra Docs</blockquote><p id=\"\">The Umbra CLI takes care of the compilation of GLSL to SPIR-V and generates the Dart API. The API handles the compilation of SPIR-V to SKSL and provides intuitive, strongly typed language support for your shader. It also adds some abstraction on top of your GLSL code which helps you focus on writing your Flutter shader code. It also adds the necessary raw GLSL code before it compiles the shader. You’ll learn about the abstraction Umbra adds in the next section.</p><p id=\"\"><strong id=\"\">1. Activate the Umbra CLI.</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4ac5d3bdde0f0f9acbec_Activate%20Umbra%20CLI.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"Code snippet with an Umbra CLI command.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=1c214a87f2\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">‍</p><p id=\"\"><strong id=\"\">2. Once activated, download the Umbra dependencies.</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4aeb48ec4a3e86c436d7_Install%20Umbra%20Dependencies.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"Code snippet with an Umbra CLI command. \"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=646e4ab82d\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">‍</p><p id=\"\">This might take a while, so sit back and relax a bit!</p><p id=\"\">‍</p><h2 id=\"\">Creating Your First Flutter Shader</h2><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-center\" data-rt-type=\"image\" data-rt-align=\"center\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4b2176d06c5faea11303_dwight.gif\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A gif that says, &quot;Let's do This!&quot;\"></div></figure><p id=\"\">You’ll learn how to add <a href=\"https://www.shadertoy.com/view/fsGcWz\" target=\"_blank\" id=\"\">this cool shader,</a> which kind of resembles the waves in water, but a bit fancier. To create it, follow these steps:</p><p id=\"\"><strong id=\"\">1. Add the umbra_flutter package in your <em id=\"\">pubspec.yaml</em></strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4b4dbf492964b7518103_Umbra%20Flutter.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with and Umbra CLI Command.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=ce5a458134\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">Or add it with the CLI by running:</p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4b5e74324d1f2a0fb4cc_Umbra%20Flutter%20CLI.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with an Umbra CLI command.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=ce5a458134\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\"><strong id=\"\">2. Create a new shader project with the Umbra CLI by running:</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4b77a64092178110c64f_Umbra%20Create%20Shader.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with an Umbra CLI command. \"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=52b846b5e5\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">‍</p><p id=\"\">This will generate a GLSL file at the root of your project where you can add your GLSL code.</p><p id=\"\"><strong id=\"\">3. Add the following GLSL code to the <em id=\"\">hello_world.glsl</em> file</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1040px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1040px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4b9159a5e711d0dd11ae_GLSL%20Hello%20World.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with GLSL shader code.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=97274f9260\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">‍</p><p id=\"\">As you can see, some of the configurations we saw in the earlier example of the GLSL code are abstracted by Umbra.</p><p id=\"\">The <em id=\"\">main()</em> function is replaced by a <em id=\"\">fragment</em> function which gives us the <em id=\"\">uv</em> (normalized coordinates of the pixel) and <em id=\"\">fragCoord</em> (coordinates of the pixel without <em id=\"\">normalization-gl_FragCoord</em>), and returns the pixel color instead of assigning it to <em id=\"\">gl_FragColor</em>.</p><p id=\"\">We also added another input called <em id=\"\">u_time</em>, which represents the time since we started. It’s crucial when you want to animate your Flutter shaders with respect to time.</p><p id=\"\"><strong id=\"\">4. Create a folder named \"shaders\" in your lib folder. Now, run the following command, which takes the path of the GLSL shader file and the output location:</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1108px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1108px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb4bdbe96581b62feee680_Generate%20Dart%20Files%20and%20SPIR-V%20binaries.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with GLSL code.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=2f6445a1b0\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">This generates the Dart files and the SPIR-V binaries at the given output location for your shader.</p><p id=\"\"><strong id=\"\">5. Create a <em id=\"\">my_shader.dart</em> file somewhere in your lib folder. Add the following code within that file and import your <em id=\"\">HelloWorld</em> shader in this file:</strong></p><figure id=\"\" class=\"w-richtext-figure-type-image w-richtext-align-fullwidth\" style=\"max-width:1254px\" data-rt-type=\"image\" data-rt-align=\"fullwidth\" data-rt-max-width=\"1254px\"><div id=\"\"><img src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb868e1654043e10a666d5_Final%20Shader%20Code.png\" loading=\"lazy\" width=\"auto\" height=\"auto\" id=\"\" alt=\"A code snippet with Flutter shader code.\"></div><figcaption id=\"\"><a href=\"https://e5c6879d-1526-4168-95a2-babbee7593d4.pieces.cloud/?p=91c34f8a03\" target=\"_blank\" id=\"\">Save to Pieces</a></figcaption></figure><p id=\"\">What you’re doing here, in short, is compiling your shader. As the process is async, you use <em id=\"\">FutureBuilder</em> to load it. Once it’s compiled, you then use the <em id=\"\">.shader()</em> method on your <em id=\"\">UmbraShader</em> object and pass it the required inputs.</p><p id=\"\">The <em id=\"\">resolution</em> is the size you want for your shader, and the <em id=\"\">uTime</em> is the <em id=\"\">delta</em> (time since we started). <em id=\"\">delta</em> is calculated with the help of Ticker. Ticker triggers a callback for every frame that increments the <em id=\"\">delta</em> by 1/60 ms.</p><p id=\"\">Finally, you pass the created Flutter shader to the CustomPainter to paint.</p><blockquote id=\"\">If you’re going to create shaders often, I would recommend saving the above code snippet in <a href=\"https://code.pieces.app/install\" target=\"_blank\" id=\"\">Pieces</a> and later updating the shader's type and inputs.</blockquote><p id=\"\">Now that you’ve built everything, run it! Your results will end up looking like what is displayed below.</p><p id=\"\">Awesome! You just created your first shader in Flutter! Isn’t that <em id=\"\">exciting?</em></p><p id=\"\">The source code for the project can be found <a href=\"https://github.com/rutvik110/Flutter-Shaders-Hello-World\" target=\"_blank\" id=\"\">here</a>.</p><h2 id=\"\">Limitations of Flutter Shaders</h2><p id=\"\">There are a few limitations and constraints when writing your GLSL shader code for Flutter. Some of the limitations are from Skia, and some are related to the current integration of shaders into Flutter itself.</p><p id=\"\">The following are some of the specific limitations of the <a href=\"https://github.com/KhronosGroup/SPIRV-Tools/blob/master/README.md\" target=\"_blank\" id=\"\">SPIR-V library</a>:</p><ul id=\"\"><li id=\"\"><em id=\"\">for</em> loops must initialize a float variable to a constant value, compare it against a constant value, and increment/modify it by a constant value</li><li id=\"\">It does not support <em id=\"\">while</em> and <em id=\"\">switch</em> statements</li><li id=\"\">The types that are supported sampler2D, bool, float, float-vector types, and square float-matrix types</li><li id=\"\">It only uses the built-in functions present in GLSL ES 100</li></ul><p id=\"\">These are some of the limitations/rules mentioned in the <a href=\"https://github.com/KhronosGroup/SPIRV-Tools/blob/master/README.md\" target=\"_blank\" id=\"\">SPIR-V library</a> that you have to adhere to while writing your GLSL code. Some of these rules are handled by Umbra while generating the raw GLSL code, but for some of them, you should be on the lookout.</p><p id=\"\">In addition, note that there isn’t Flutter web support for shaders at this point. These limitations will likely go away in future versions of the library.</p><h3 id=\"\">Next Steps</h3><p id=\"\">The initial release for supporting Flutter shaders paves the way for some creative coding and unlocks new and never-before-seen experiences.</p><p id=\"\">While I researched shaders in Flutter, I found some interesting features on the Flutter GitHub that may land in the near future. Some of them add support for compiling your <a href=\"https://github.com/flutter/flutter/issues/93498#issuecomment-1141271458\" target=\"_blank\" id=\"\">GLSL shaders to SPIR-V through the Flutter CLI.</a> There are even proposals that would make it possible to <a href=\"https://github.com/flutter/flutter/issues/58361\" target=\"_blank\" id=\"\">create custom shaders and ColorFilters with SKSL</a>, which could be extremely useful for image/video editing apps and games in general.</p><p id=\"\">If you are interested in staying up-to-date on new developments in shaders or reading more technical articles like this, be sure to subscribe to the <a href=\"https://code.pieces.app/blog\" target=\"_blank\" id=\"\">Pieces blog</a> to get updates on weekly articles and check out <a href=\"https://code.pieces.app/install\" target=\"_blank\" id=\"\">Pieces</a>, the fastest, smartest AI Assistant for code snippets and screenshots.</p><h4 id=\"\">An Easier Way to Save Your Flutter Fragments</h4><p id=\"\">When developing Flutter applications, you may have tons of widgets you save that you want to reuse later, but you just do not have them in a safe place where you can access them. There also may be the scenario where you are combing through Flutter and Dart documentation, and you want to save examples that come in handy when implementing a new feature or figuring out which widget to use for different circumstances.</p><p id=\"\"><strong id=\"\">Pieces</strong> helps you save all of your useful code snippets efficiently through a desktop application and integrations. Using Pieces, you can save any code snippets from StackOverflow with the click of a button using the Chrome extension, have your code autosaved from locally-hosted ML algorithms that recognize your code patterns, auto-classify snippets by language, share code with others using generated links, and more! The Pieces for Developers Suite is continuously being developed, and there’s some groundbreaking stuff that is being put together to share, reuse, and save code snippets.</p><p id=\"\"><a href=\"https://code.pieces.app/install\" target=\"_blank\" id=\"\">Try Pieces now using the personal plan for free</a>!</p>",
  "Date": "Wed Jun 29 2022 00:00:00 GMT+0000 (Coordinated Universal Time)",
  "Author": "Rutvik Tak",
  "Author Photo": "https://uploads-ssl.webflow.com/6143afec68f555387049efb3/62bb487c7d8429fd4a8e0972_rutviktak.jpeg",
  "AMP URL": "",
  "TOC based on...": "h2,h3",
  "Tags": "dart; flutter; shaders",
  "CTA": "",
  "CTA link": "",
  "Canonical URL": ""
}
