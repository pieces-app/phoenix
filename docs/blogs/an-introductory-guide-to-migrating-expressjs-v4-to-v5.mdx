![](https://uploads-ssl.webflow.com/6143afec68f555387049efb3/63dd7918220dd879ddab0f2d_migratingexpress_js_ac8aad3349b859cabdc038ac31812f31_2000.jpeg)
""
# An Introductory Guide to Migrating Express.js V4 to V5
> Wed Apr 05 2023 16:53:15 GMT+0000 (Coordinated Universal Time)
<figure class="w-richtext-figure-type-image w-richtext-align-center" data-rt-type="image" data-rt-align="center"><div><img alt="A subway tunnel." src="https://uploads-ssl.webflow.com/6143afec68f555387049efb3/63dd7918220dd8c18dab0f2e_migratingexpress_js_780ed6f854ee1bd1dd3aacde4308b6e3_800.jpeg"><div.new.line><figure.new.line><p>Node.js is a quick JavaScript runtime environment used for creating server-side apps. Express.js is needed to handle file serving, request handling, and HTTP method handling. According to its documentation,<a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer"> <u>Express</u></a> is a minimal and flexible <strong><em>Node</em></strong>.<strong><em>js</em></strong> web application framework that provides a robust set of features for web and mobile applications.<p.new.line><p>In this tutorial, we&#x27;ll explore the newly released Express.js V5 and how to upgrade from Express.js V4 to V5. We&#x27;ll also look at the enhancements and new features provided by Express.js V5, as well as explore how it can be used to build a web application.<p.new.line><p>The recently released Express.js V5 contains a number of enhancements and new features aimed at boosting the functionality of the framework. The migration from V4 to V5 might be a little disconcerting, though, because of possible problems or deprecation of features within this update.<p.new.line><h2 id="8c1at">Overview of Express.js<h2.new.line><p>Express.js as a Node.js backend framework is efficient for building restful server-side applications. Express.js apps process client requests using particular HTTP request methods and route paths. They also carry out route handler callbacks that have been set up for the routes.<p.new.line><p>Express has a well-structured approach to middleware functions that can easily be incorporated into the request-response processing cycles. The structure gives each middleware function the needed access to other middleware functions, forming a chain of addition processing on the incoming request and the outgoing response. This provides the developers with easy access and termination of request-response cycles within the middleware functions.<p.new.line><h2 id="8apet">Why Migrate from Express.js V4 to V5?<h2.new.line><p>At the core of the new features and improvements in Express.js V5 is the increased efficiency of the framework. This improves the general performance of the server-side applications built with it. Amongst the improvements is the handling of rejected promises. Previously, we explicitly implemented error handlers for rejected promises or errors. Now, we can simply send the errors to an error handling middleware to properly process them as well.<p.new.line><p>Let&#x27;s explore the changes even further, but please note that Express.js V5 is still in its beta stage.<p.new.line><h3 id="8rs71">Rejected Promise and Error Handling<h3.new.line><p>In Express.js V4, when an error or rejection in a request handler is not explicitly handled or passed down to an error-handling middleware, it could potentially cause the app to crash. However, with Express.js V5, the application doesn’t crash; instead, a 500 response containing either the error or the rejected value is returned. Better yet, we can handle the event by passing it down to an error-handling middleware.<p.new.line><pre>app.get(&quot;/throw&quot;, async () =&gt; {<br> return await Promise.resolve().then(() =&gt; {<br> throw new Error(&quot;Pieces: error&quot;);<br>  });<br>});<br><br>app.get(&quot;/reject&quot;, () =&gt; {<br> return Promise.reject(&quot;Pieces: rejected&quot;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=44c845ab2f" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><p>The above snippet would surely crash the entire application in Express.js V4, but thanks to V5 updates, it won’t.<p.new.line><h3 id="f06ds">Return of app.router Object<h3.new.line><p>The app.router reference object to an Express app’s built-in router instance, which was removed in Express.js V4, has been brought back in V5. Now, we can define middleware and routes on the <code>app.router</code> object:<p.new.line><pre>const express = require(&quot;express&quot;);<br>const app = express();<br>const router = app.router;<br><br>router.post(&quot;/create&quot;, (req, res) =&gt; {<br> // do something...<br>  res.status(status).send(&quot;Created from Pieces!&quot;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=c75b4a885f" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><h3 id="7vecm">Change of Syntax for Route Path Matching<h3.new.line><p>Express.js V5 came with new parameter modifiers to the route path. Route paths, which define endpoints as strings, string patterns, or regular expressions, are mostly utilized in app and router objects for incoming requests. These changes include:<p.new.line><ul><li>The use of the <code>?</code>, <code>*</code>, and <code>+</code> characters, which should be added as suffixes to route parameters.<li.new.line><li>The use of <code>?</code> to specify optional parameters.<li.new.line><li>The use of <code>*</code> to match zero or more parameters.<li.new.line><li>The use of <code>+</code> for one or more parameters.<li.new.line><li>When using regular expressions in matching groups:<li.new.line><ul><li><code>/(\\\\d+)</code> replaced <code>/\\\\d+</code><li.new.line><li><code>(*)</code> won’t be valid any longer, and must be written as <code>(.*)</code>.<li.new.line><ul.new.line><li>The use of <code>req.params</code> in a named matching group like <code>/:foo(.*)</code> can only be captured as <code>req.params.foo</code>, and is not available as <code>req.params[0]</code>.<li.new.line><ul.new.line><pre>app.get(&quot;/inventory/:ids*/pieces&quot;, (req, res) =&gt; {<br>  res.status(status).send(&quot;Check the warehouse inventory!&quot;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=41bc469248" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><p>The above snippet shows a route path that will match <code>/inventory/pieces</code>, <code>/inventory/1/pieces</code>, <code>/inventory/1/2/pieces</code>, and so on when substituted.<p.new.line><pre>app.get(&quot;/inventory/:ids+/pieces&quot;, (req, res) =&gt; {<br>  res.status(status).send(&quot;Get the warehouse inventory with id!&quot;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=6bf64fb9c7" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><p>The above snippet shows a route path that will match <code>/inventory/1/pieces</code>, <code>/inventory/1/2/pieces</code>, and so on when substituted, but not <code>/inventory/pieces</code>.<p.new.line><pre>app.get(&quot;/inventory/:id?/pieces&quot;, (req, res) =&gt; {<br>  res.status(status).send(&quot;Check only the warehouse inventory!&quot;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=39514fbbc4" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><p>The above snippet shows a route path that will match <code>/inventory/pieces</code>, <code>/inventory/1/pieces</code>, and so on when substituted, but not <code>/inventory/1/2/pieces</code>.<p.new.line><p>As mentioned above, all matching group expressions have to be<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="noopener noreferrer"> <u>RegExp</u></a>. In Express.js V4, the use of <code>(*)</code> in route path was valid, but will fail in Express.js V5. The valid RegExp equivalent is <code>(.*)</code>.<p.new.line><pre>app.get(&quot;/inventory/:id(.*)&quot;, (req, res) =&gt; {<br>  res.status(status).send(req.params);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=c18e4db824" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><p>The above snippet will return <code>{&quot;id&quot;:&quot;1&quot;}</code> as a response in Express.js V5, unlike <code>(*)</code>, which will return <code>{&quot;0&quot;:&quot;1&quot;,&quot;id&quot;:&quot;1&quot;}</code> as a response in Express.js V4.<p.new.line><h3 id="9ufdo">Asynchronous Behavior by res.render<h3.new.line><p>The <code>res.render</code> in Express.js V5 now supports asynchronous callback as its parameter. This improvement helps avoid bugs caused by view engines that are synchronous in implementation; the callback function handles any rendering error that may occur when trying to send the rendered HTML as a response to the client.<p.new.line><h3 id="7hco8">Changes to the req.query Object<h3.new.line><p>The nature of the <code>req.query</code> property has been changed to a <code>getter</code><strong>, </strong>unlike its writable nature in Express.js V4.  The default query parser has been changed from extended to simple. This update also comes with the equivalent setter to change the default query parser if need be.<p.new.line><pre>const express = require(&quot;express&quot;);<br>const app = express();<br>console.log(app.get(&quot;query parser&quot;));<br>app.set(&quot;query parser&quot;, &quot;extended&quot;);</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=007c4293ac" target="_blank" rel="noopener noreferrer">Save this code</a></u><p.new.line><h3 id="a2v2h">The Use of req.host to Manage Port<h3.new.line><p>The <code>req.host</code> property now manages and returns the host value from the Host HTTP header. For example, if the server-side application is running on <code>http://localhost:8080</code>, then the code below will return <code>localhost:3000</code> on Express.js V5:<p.new.line><pre>app.get(&quot;/heath-check&quot;, (req, res) =&gt; {<br>  res.status(status).send(&#x60;host: ${req.host}&#x60;);<br>});</pre><p><u><a href="https://user-d6b93f60-4441-4576-aac8-a041d598ff4c-fhcmbheklq-uc.a.run.app/?p=064344bd44">Save this code</a></u><p.new.line><h3 id="aem2f">Additional Breaking Changes in Express.js V5 from V4<h3.new.line><p>Let’s enumerate some potential breaking changes introduced in V5:<p.new.line><ul><li>The <code>req.acceptsCharset()</code>, <code>req.acceptsEncoding()</code>, and <code>req.acceptsLanguage()</code> functions have been pluralized to <code>req.acceptsCharsets()</code>, <code>req.acceptsEncodings()</code>, and <code>req.acceptsLanguages()</code> in Express.js V5.<li.new.line><li>The <code>app.del()</code> function for registering <code>HTTP DELETE</code> routes has been renamed to <code>app.delete()</code>.<li.new.line><ul.new.line><p>The following function signatures have been changed as shown below:<p.new.line><ul><ul><li><code>res.json(obj, status</code>) to <code>res.status(status).json(obj)</code><li.new.line><li><code>res.send(body, status)</code> to <code>res.status(status).send(obj)</code><li.new.line><li><code>res.jsonp(obj, status)</code> to <code>res.status(status).jsonp(obj)</code><li.new.line><li><code>res.send(status)</code> (where <code>status</code> is a number) to <code>res.sendStatus(statusCode)</code><li.new.line><li><code>res.sendfile()</code> to <code>res.sendFile()</code><li.new.line><ul.new.line><li>The deprecated function signature, <code>app.param(fn)</code>, is no longer supported in Express.js V5<li.new.line><ul.new.line><h3 id="2kpff">Migrating an Existing Express.js V4 Application to V5<h3.new.line><p>Luckily, migrating an existing server-side application to Express.js V5 won’t involve a lot of heavy lifting. The first approach would be to upgrade from V4 to V5 of Express.js by running the command below:<p.new.line><pre>npm install &quot;express@&gt;=5.0.0-beta.1&quot; --save</pre><p>First, run the npm outdated command to see any packages that need to be updated. Next, re-run any existing test suites on the project, or rebuild the entire project to see all breaking changes. Follow the tutorial to fix any issues that occur.<p.new.line><h2 id="dofdc">Conclusion<h2.new.line><p>In this article, we explored the exciting new features and improvements in Express.js V5, including the addition of route parameter modifier characters, and improved <code>RegExp</code> parsing in route paths. Express.js V5 has restored critical attributes and values that were absent from Express.js V4, such as <code>app.router</code> and the port in <code>req.host</code>. Furthermore, synchronous view rendering bugs have been resolved. Likewise, V5 handles rejected promise handling in middleware and handlers automatically. For more information about Express.js V5, check out the<a href="https://expressjs.com/en/guide/migrating-5.html" target="_blank" rel="noopener noreferrer"> <u>documentation</u></a>.<p.new.line>\n
