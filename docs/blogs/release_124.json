{
  "Title": "Scheduled Execution in Express Using Cron Jobs",
  "Slug": "scheduled-execution-in-express-using-cron-jobs",
  "Collection ID": "642da2c43fe34c364a69857f",
  "Item ID": "642da2c43fe34c4e1b698a30",
  "Created On": "Fri Dec 30 2022 15:31:03 GMT+0000 (Coordinated Universal Time)",
  "Updated On": "Wed Mar 29 2023 19:29:02 GMT+0000 (Coordinated Universal Time)",
  "PublishedOn": "Wed Apr 05 2023 16:53:15 GMT+0000 (Coordinated Universal Time)",
  "MainImage": "https://uploads-ssl.webflow.com/6143afec68f555387049efb3/63dd6077cb53c96594e7b4af_cronjob_aff75d951e7ddd68ced696cde1a23d6c_2000.jpeg",
  "Post summary": "Cron is a Linux command line utility that schedules jobs for the computer to execute. Let's discuss how to implement it in your next project.",
  "FullPost": "<p>Scheduled execution in programming relates to code blocks set to be executed at a specific time by the computer. Also, you can set these code blocks to run more than once following a specified interval. Different tools help set up these scheduled executions; cron is an example. To continue with this article, you’ll need <u><a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"noopener noreferrer\">Node.js</a></u> installed on your system and a fundamental knowledge of JavaScript.</p><h2 id=\"6ef85\">What is Cron?</h2><p><code>Cron</code> is a Linux command line utility that schedules jobs for the computer to execute. It allows it to schedule repetitive tasks, or tasks that the computer should run at a specific time or date.</p><h2 id=\"3ndkl\">Use Cases for Cron</h2><p>There are several cases where a cron job is useful. A simple instance is a reminder or alarm. In this case, developers can facilitate setting up reminders or alarms by using cron to specify when the computer should send a reminder or trigger an alarm. In an express server, a cron job can be implemented in the following cases:</p><ul><li>Triggering an email notification for a schedule.</li><li>Checking on the database periodically.</li><li>Sending out monthly newsletters.</li></ul><h3 id=\"55dg1\">Node-Cron</h3><p>The <code>node-cron</code> is a Node.js library that allows you to set up cron jobs in a Node.js server. In this article, we’ll use node-cron to demonstrate how to schedule jobs on an express server.</p><p>First, we’ll examine how <code>node-cron</code> works. To do this, you’ll need to add the package to your application by running the command below:</p><pre>npm install --save node-cron</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=2b3e499ff7\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>To get started with using node-cron, use the code below:</p><pre>cron.schedule(&quot; */2 * * * * *&quot;, () =&gt; {<br>  console.log(&quot;A cron job that runs every 2 seconds&quot;);<br>});</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=39db43a1fe\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>In the code block above, we have the cron package assigned to a variable cron. Then, we call the <code>schedule</code> method as seen on line 3. The <code>schedule</code> method accepts two required parameters and an optional configuration parameter:</p><p>The first parameter is the expression for the schedule in a string format (<code>”* * * * * *”</code>), where each asterisk represents a field. The first asterisk is the placeholder for seconds; this is also not required. The second placeholder is for minutes, and the following are for hours, day of the month, month, and day of the week. You can indicate the day of the week using names or 0-7. Multiple values can be separated by a comma in a placeholder, e.g., <code>“2,3,4 * * * *”</code>. This means the server will execute the job scheduled at every second, third, and fourth minute. You can also use steps by having a forward slash after the asterisk and the value, e.g.,<code> “*/2 * * * * *”</code>. This will execute the job every 2 minutes. The second parameter passed to the <code>schedule</code><strong> </strong>method is the function to be executed.</p><p>Lastly, we have the third optional parameter. This is a configuration object with keys:</p><ul><li><code>schedule</code>: This is a boolean type. The library will schedule immediately if the value is truthy. Otherwise, the library will schedule when the <code>start</code><strong> </strong>method on the schedule executes. We can also halt the schedule by calling the stop method.</li><li><code>timezone</code><strong>: </strong>This is a string value for the timezone in which you are scheduling the expression.</li><li><code>name</code>: This is the name of the schedule. The package will autogenerate a name if you do not provide a name.</li><li><code>recoverMissedExecutions</code>: This is a boolean value. It allows you to specify if the package should catch missed executions instead of skipping them.</li></ul><pre>const job = cron.schedule(<br>  &quot; * */40 * * * *&quot;,<br>  () =&gt; {<br>    console.log(&quot;A cron job that runs every 40 minutes&quot;);<br>    console.log(&quot;This job will start in 20 minutes&quot;);<br>  },<br>  {<br>    scheduled: false,<br>    timezone: &quot;Nigeria/Lagos&quot;,<br>  }<br>);<br><br>// this will start the job in 20 minutes<br>setTimeout(() =&gt; {<br>  job.start();<br>}, 1000 * 60 * 20);</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=89a54fab90\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><h2 id=\"dp159\">Setting up an Express Application</h2><p>Now, we’ll set up an express server and see how we can use the node-cron package; you can find the project repository <u><a href=\"https://github.com/MelvinManni/express-cron\" target=\"_blank\" rel=\"noopener noreferrer\">here</a></u>. The first step is to create an express server. To do this, we’ll create an &quot;express-cron&quot; folder and initialize a node application with this command:</p><pre>npm init -y</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=28d14c9892\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>Next, we’ll add all required packages with the command:</p><pre>npm install --save express node-cron nodemon</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=8ce04a8a3c\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>The <u><a href=\"https://www.npmjs.com/package/nodemon\" target=\"_blank\" rel=\"noopener noreferrer\">nodemon</a></u> package from the above command will automatically restart the server when file changes are detected. Once we’ve added the required packages, we’ll add scripts to <code>package.json</code>.</p><pre>{<br>  &quot;name&quot;: &quot;cron&quot;,<br>  &quot;version&quot;: &quot;1.0.0&quot;,<br>  &quot;main&quot;: &quot;server.js&quot;,<br>  &quot;license&quot;: &quot;MIT&quot;,<br>  //add this to  package.json<br>  &quot;scripts&quot;: {<br>    &quot;start&quot;: &quot;node server.js&quot;,<br>    &quot;dev&quot;: &quot;nodemon server.js&quot;<br>  },<br>  //scripts ends here<br>  &quot;dependencies&quot;: {<br>    &quot;express&quot;: &quot;^4.18.1&quot;,<br>    &quot;node-cron&quot;: &quot;^3.0.2&quot;,<br>    &quot;nodemon&quot;: &quot;^2.0.20&quot;<br>  }<br>}</pre><p><a href=\"https://melvin.pieces.cloud/?p=827f44a6cd\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></p><p>The next step will be to set up our express server:</p><pre>const express = require(&quot;express&quot;);<br>const app = express()<br><br>app.get(&quot;/&quot;, (_, res) =&gt; {<br>  res.send(&quot;Welcome to CRON server&quot;);<br>});<br><br><br>const PORT = process.env.PORT || 4400;<br><br>app.listen(PORT, () =&gt; {<br>  console.log(&#x60;PORT running on: ${PORT}&#x60;);<br>});</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=43774abf53\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>We import the express package in the code block above and assign it to the variable <code>app</code><strong>. </strong>On line 4, we have the home route for the server; this will send a response with the &quot;welcome to cron server&quot; message to the browser when we hit that route. Then, we’ll set the server to listen to the port set up in the <u><a href=\"https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env\" target=\"_blank\" rel=\"noopener noreferrer\">environment variable</a></u> or 4400. Finally, to start the application in development mode, we’ll run the following command:</p><pre>npm run dev     </pre><p><u><a href=\"https://melvin.pieces.cloud/?p=bd0b4cbd96\">Save this code</a></u></p><figure class=\"w-richtext-figure-type-image w-richtext-align-center\" data-rt-type=\"image\" data-rt-align=\"center\"><div><img alt=\"A CRON server rendered in the browser.\" src=\"https://uploads-ssl.webflow.com/6143afec68f555387049efb3/63af0436c258ebb4d8672d37_image1_d3b626db6941982f5c9cfead84ab4069_800.png\"></div></figure><h3 id=\"5jfao\">Using Node-cron in an Express App</h3><p>To use the node-cron in an express app, we’ll assign the package to the variable <code>cron</code><strong>. </strong>Then, as discussed in the section above, we must call the schedule method and pass in the parameters.</p><pre>const express = require(&quot;express&quot;);<br>const cron = require(&quot;node-cron&quot;);<br><br>const app = express();<br><br>app.get(&quot;/&quot;, (_, res) =&gt; {<br>  res.send(&quot;Welcome to CRON server&quot;);<br>});<br><br>cron.schedule(&quot; */2 * * * * *&quot;, () =&gt; {<br>  console.log(&quot;A cron job that runs every 2 seconds&quot;);<br>});<br><br>cron.schedule(&quot; * */2 * * * *&quot;, () =&gt; {<br>  console.log(&quot;A cron job that runs every 2 minutes&quot;);<br>});<br><br>const job = cron.schedule(<br>  &quot; * */40 * * * *&quot;,<br>  () =&gt; {<br>    console.log(&quot;A cron job that runs every 40 minutes&quot;);<br>    console.log(&quot;This job will start in 20 minutes&quot;);<br>  },<br>  {<br>    scheduled: false,<br>    timezone: &quot;Nigeria/Lagos&quot;,<br>  }<br>);<br><br>// this will start the job in 20 minutes<br>setTimeout(() =&gt; {<br>  job.start();<br>}, 1000 * 60 * 20);<br><br>const PORT = process.env.PORT || 4400;<br><br>app.listen(PORT, () =&gt; {<br>  console.log(&#x60;PORT running on: ${PORT}&#x60;);<br>});</pre><p><u><a href=\"https://melvin.pieces.cloud/?p=7ef543b990\" target=\"_blank\" rel=\"noopener noreferrer\">Save this code</a></u></p><p>From the code block above, we have cron jobs scheduled in the server on lines 10, 14 and 18. The job created on line 18 starts on line 32.</p><p>The node-cron package has other methods:</p><ul><li><code>validate</code>: The validate method allows you to check if an expression for a schedule is a valid node-cron expression.</li><li><code>getTasks</code>: This returns a map with the schedule name as key and the schedule details as value.</li></ul><h2 id=\"7r24j\">Conclusion and Resources</h2><p>This article covered implementing a cron job in an express server using the <code>node-cron</code> package. We reviewed the methods on the package, their functionalities, and how we can use them. You can check the <u><a href=\"https://github.com/node-cron/node-cron#node-cron\" target=\"_blank\" rel=\"noopener noreferrer\">official documentation</a></u> for more extensive information on how to use the <code>node-cron</code> package.</p>\n\n    <figure data-rt-type=\"video\" data-rt-align=\"center\">\n        <!-- strchf script -->\n<script>\n        if(window.strchfSettings === undefined) window.strchfSettings = {};\n    window.strchfSettings.stats = {url: \"https://pieces-app.storychief.io/en/scheduled-execution-in-express-using-cron-jobs?id=2015796836&type=26\",title: \"Scheduled Execution in Express Using Cron Jobs\",id: \"f48cd0d8-d254-4e17-a18e-3d20939412eb\"};\n            (function(d, s, id) {\n      var js, sjs = d.getElementsByTagName(s)[0];\n      if (d.getElementById(id)) {window.strchf.update(); return;}\n      js = d.createElement(s); js.id = id;\n      js.src = \"https://d37oebn0w9ir6a.cloudfront.net/scripts/v0/strchf.js\";\n      js.async = true;\n      sjs.parentNode.insertBefore(js, sjs);\n    }(document, 'script', 'storychief-jssdk'))\n    </script>\n<!-- End strchf script -->    </figure>\n",
  "Date": "Fri Dec 30 2022 15:31:03 GMT+0000 (Coordinated Universal Time)",
  "Author": "Melvin Kosisochukwu",
  "Author Photo": "https://uploads-ssl.webflow.com/6143afec68f555387049efb3/631f585b56ce8d377c1a720e_melvin_f6d6ce9d3c1958a984f4f11720f627d4_1000.jpeg",
  "AMP URL": "",
  "TOC based on...": "h2,h3",
  "Tags": "linux",
  "CTA": "",
  "CTA link": "",
  "Canonical URL": ""
}
